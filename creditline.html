<!DOCTYPE html>
<html>
<head>
    <title>Credit Line Form</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
</head>
<body>
    <h1>Credit Line Form</h1>
    <form id="creditline-form">
        
        <label for="shopname">Shop Name:</label>
        <input type="text" id="shopname" name="shopname" required><br>

        <label for="ownername">Owner Name:</label>
        <input type="text" id="ownername" name="ownername" required><br>

        <label for="mobileNumber">Mobile Number:</label>
        <input type="text" id="mobileNumber" name="mobileNumber" required><br>

        <label for="shopAddress">Shop Address:</label>
        <input type="text" id="shopAddress" name="shopAddress" required><br>

        <label for="aadhaarPhoto">Aadhaar Photo:</label>
        <input type="file" id="aadhaarPhoto" name="aadhaarPhoto" required><br>

        <label for="panPhoto">Pan Photo:</label>
        <input type="file" id="panPhoto" name="panPhoto" required><br>

        <label for="shopPhoto">Shop Photo:</label>
        <input type="file" id="shopPhoto" name="shopPhoto" required><br>

        <label for="ownerPhoto">Owner Photo:</label>
        <input type="file" id="ownerPhoto" name="ownerPhoto" required><br>

        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCaiK6I2ft33OtoNISnJ1UAep6E7jBRfJ0",
            authDomain: "utkalb2b-web.firebaseapp.com",
            projectId: "utkalb2b-web",
            storageBucket: "utkalb2b-web.appspot.com",
            messagingSenderId: "974973982982",
            appId: "1:974973982982:web:90a779568f593817c5a687",
            measurementId: "G-QRX9527XPG"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const firestore = firebase.firestore();

        async function submitForm() {
            const form = document.getElementById('creditline-form');
            const mobileNumber = document.getElementById('mobileNumber').value;
            const shopAddress = document.getElementById('shopAddress').value;

            const aadhaarPhoto = document.getElementById('aadhaarPhoto').files[0];
            const panPhoto = document.getElementById('panPhoto').files[0];
            const shopPhoto = document.getElementById('shopPhoto').files[0];
            const ownerPhoto = document.getElementById('ownerPhoto').files[0];

            try {
                const aadhaarRef = storage.ref('aadhaar/' + aadhaarPhoto.name);
                const panRef = storage.ref('pan/' + panPhoto.name);
                const shopRef = storage.ref('shop/' + shopPhoto.name);
                const ownerRef = storage.ref('owner/' + ownerPhoto.name);

                await Promise.all([
                    aadhaarRef.put(aadhaarPhoto),
                    panRef.put(panPhoto),
                    shopRef.put(shopPhoto),
                    ownerRef.put(ownerPhoto)
                ]);

                const aadhaarURL = await aadhaarRef.getDownloadURL();
                const panURL = await panRef.getDownloadURL();
                const shopURL = await shopRef.getDownloadURL();
                const ownerURL = await ownerRef.getDownloadURL();

                // Save data to Firestore
                await firestore.collection('creditLines').add({
                    mobileNumber,
                    shopAddress,
                    aadhaarPhoto: aadhaarURL,
                    panPhoto: panURL,
                    shopPhoto: shopURL,
                    ownerPhoto: ownerURL
                });

                alert('Successfully Applied for Credit Line. You can download the agreement as PDF.');

                // Redirect or open the PDF download page
                window.location.href = 'path_to_your_pdf_download_page.html';
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }
    </script>
</body>
</html>
