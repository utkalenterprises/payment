<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Payment</title>
    <style>
        /* Existing styles... */

        /* New styles for error message */
        #errorMessage {
            display: none;
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            color: #b71c1c;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="header">
        <img src="logo.png" alt="Utkal Enterprises Logo">
        <span>UTKAL ENTERPRISES</span>
    </div>

    <div class="container">
        <h1>UPI Payment</h1>
        <div class="form-group">
            <label for="shopName">Shop Name / Invoice Number</label>
            <input type="text" id="shopName" placeholder="Enter Shop Name or Invoice Number">
        </div>
        <div class="form-group">
            <label for="amount">Amount (INR)</label>
            <input type="number" id="amount" placeholder="Enter Amount">
        </div>
        <button onclick="makePayment()">Pay Now</button>

        <!-- New error message div -->
        <div id="errorMessage"></div>

        <div class="payment-logos">
            <img src="certificate1.png" alt="Certificate Logo 1">
            <img src="certificate2.png" alt="Certificate Logo 2">
            <img src="certificate3.png" alt="Certificate Logo 3">
        </div>
    </div>

    <div class="footer">
        &copy; 2024 UTKAL ENTERPRISES. All Rights Reserved.
        <br>
        <a href="terms.html" style="color: #fff; text-decoration: underline;">Payment Terms and Conditions</a>
    </div>

    <script>
        // Existing functions...

        // Updated makePayment function with error handling
        function makePayment() {
            const shopName = document.getElementById('shopName').value;
            const amount = document.getElementById('amount').value;
            const upiId = 'paytmqr281005050101cpjybwznm3x0@paytm'; // Your UPI ID

            if (shopName && amount) {
                // Send data to Google Apps Script
                fetch('https://script.google.com/macros/s/AKfycbw4ftIZFaqH46E1sJT-cKiB6a4xW2tBebuzJipaxaGAM6Uqtcq39MwWokTiHpOIjKwv/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ shopName: shopName, amount: amount }),
                });

                // Handle the UPI payment with encoded parameters
                const upiLink = `upi://pay?pa=${encodeURIComponent(upiId)}&pn=UTKAL ENTERPRISES&am=${encodeURIComponent(amount)}&cu=INR&tn=${encodeURIComponent(shopName)}`;
                
                // Open the UPI app
                window.location.href = upiLink;

                // Set up a listener for when the user returns to the page
                window.addEventListener('focus', checkPaymentStatus);
            } else {
                showError('Please enter both Shop Name/Invoice Number and Amount.');
            }
        }

        // New function to check payment status
        function checkPaymentStatus() {
            // Remove the event listener to prevent multiple checks
            window.removeEventListener('focus', checkPaymentStatus);

            // Here you would ideally check the payment status with your backend
            // For this example, we'll simulate a check after a short delay
            setTimeout(() => {
                // Simulating a random payment result
                const paymentSuccess = Math.random() < 0.5;

                if (paymentSuccess) {
                    showSuccess('Payment successful! Thank you for your purchase.');
                } else {
                    showError('Payment failed. Please try again or use a different UPI app.');
                }
            }, 1000);
        }

        // Function to show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Function to show success message
        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.backgroundColor = '#e8f5e9';
            errorDiv.style.borderColor = '#c8e6c9';
            errorDiv.style.color = '#1b5e20';
            errorDiv.style.display = 'block';
        }
    </script>

</body>
</html>
